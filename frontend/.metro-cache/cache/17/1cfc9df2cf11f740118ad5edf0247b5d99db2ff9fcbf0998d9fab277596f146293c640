{"dependencies":[{"name":"expo/virtual/env","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dgHc21cgR+buKc7O3/dChhD5JJk=","exportNames":["*"],"imports":1}},{"name":"expo-notifications","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":52,"index":52}}],"key":"nrBDtkRVez7cBhLzyaRjl+xVfvE=","exportNames":["*"],"imports":1}},{"name":"expo-device","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":53},"end":{"line":2,"column":38,"index":91}}],"key":"bBpmAhO1g++sdeUzQmFVGoQIVwg=","exportNames":["*"],"imports":1}},{"name":"react-native-web/dist/exports/Platform","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dV3bI3NOD8bfMzaIniMaFGy/nn8=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":133},"end":{"line":4,"column":69,"index":202}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"axios","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":203},"end":{"line":5,"column":26,"index":229}}],"key":"e45rENb5cSu0Yeh6oC1uWb7lEp4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopNamespace(e) {\n    if (e && e.__esModule) return e;\n    var n = {};\n    if (e) Object.keys(e).forEach(function (k) {\n      var d = Object.getOwnPropertyDescriptor(e, k);\n      Object.defineProperty(n, k, d.get ? d : {\n        enumerable: true,\n        get: function () {\n          return e[k];\n        }\n      });\n    });\n    n.default = e;\n    return n;\n  }\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.registerForPushNotifications = registerForPushNotifications;\n  exports.registerTokenWithServer = registerTokenWithServer;\n  exports.setupPushNotifications = setupPushNotifications;\n  var _expoVirtualEnv = require(_dependencyMap[0], \"expo/virtual/env\");\n  var _expoNotifications = require(_dependencyMap[1], \"expo-notifications\");\n  var Notifications = _interopNamespace(_expoNotifications);\n  var _expoDevice = require(_dependencyMap[2], \"expo-device\");\n  var Device = _interopNamespace(_expoDevice);\n  var _reactNativeWebDistExportsPlatform = require(_dependencyMap[3], \"react-native-web/dist/exports/Platform\");\n  var Platform = _interopDefault(_reactNativeWebDistExportsPlatform);\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[4], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _axios = require(_dependencyMap[5], \"axios\");\n  var axios = _interopDefault(_axios);\n  const BACKEND_URL = _expoVirtualEnv.env.EXPO_PUBLIC_BACKEND_URL;\n\n  /**\n   * Request notification permissions and get Expo push token\n   */\n  async function registerForPushNotifications() {\n    try {\n      // Check if we're on a physical device\n      if (!Device.isDevice) {\n        console.log('Push notifications require a physical device');\n        return null;\n      }\n\n      // Check existing permissions\n      const {\n        status: existingStatus\n      } = await Notifications.getPermissionsAsync();\n      let finalStatus = existingStatus;\n\n      // Request permissions if not already granted\n      if (existingStatus !== 'granted') {\n        const {\n          status\n        } = await Notifications.requestPermissionsAsync();\n        finalStatus = status;\n      }\n      if (finalStatus !== 'granted') {\n        console.log('Failed to get push notification permission');\n        return null;\n      }\n\n      // Get Expo push token\n      const tokenData = await Notifications.getExpoPushTokenAsync({\n        projectId: 'safeguard-app'\n      });\n      const token = tokenData.data;\n      console.log('Expo Push Token:', token);\n\n      // Configure Android notification channel\n      if (Platform.default.OS === 'android') {\n        await Notifications.setNotificationChannelAsync('default', {\n          name: 'SafeGuard Alerts',\n          importance: Notifications.AndroidImportance.MAX,\n          vibrationPattern: [0, 250, 250, 250],\n          lightColor: '#EF4444',\n          sound: 'default'\n        });\n        await Notifications.setNotificationChannelAsync('emergency', {\n          name: 'Emergency Alerts',\n          importance: Notifications.AndroidImportance.MAX,\n          vibrationPattern: [0, 500, 250, 500],\n          lightColor: '#FF0000',\n          sound: 'default',\n          bypassDnd: true\n        });\n      }\n      return token;\n    } catch (error) {\n      console.error('Error registering for push notifications:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Register push token with backend server\n   */\n  async function registerTokenWithServer(token) {\n    try {\n      const authToken = await AsyncStorage.default.getItem('auth_token');\n      if (!authToken) {\n        console.log('No auth token available to register push token');\n        return false;\n      }\n      await axios.default.post(`${BACKEND_URL}/api/push-token/register`, token, {\n        headers: {\n          Authorization: `Bearer ${authToken}`,\n          'Content-Type': 'application/json'\n        }\n      });\n      await AsyncStorage.default.setItem('push_token', token);\n      console.log('Push token registered with server successfully');\n      return true;\n    } catch (error) {\n      console.error('Failed to register push token with server:', error.response?.data || error.message);\n      return false;\n    }\n  }\n\n  /**\n   * Full push notification setup - call after login\n   */\n  async function setupPushNotifications() {\n    const token = await registerForPushNotifications();\n    if (token) {\n      return await registerTokenWithServer(token);\n    }\n    return false;\n  }\n});","lineCount":139,"map":[[27,2,12,0,"exports"],[27,9,12,0],[27,10,12,0,"registerForPushNotifications"],[27,38,12,0],[27,41,12,0,"registerForPushNotifications"],[27,69,12,0],[28,2,73,0,"exports"],[28,9,73,0],[28,10,73,0,"registerTokenWithServer"],[28,33,73,0],[28,36,73,0,"registerTokenWithServer"],[28,59,73,0],[29,2,104,0,"exports"],[29,9,104,0],[29,10,104,0,"setupPushNotifications"],[29,32,104,0],[29,35,104,0,"setupPushNotifications"],[29,57,104,0],[30,2,112,1],[30,6,112,1,"_expoVirtualEnv"],[30,21,112,1],[30,24,112,1,"require"],[30,31,112,1],[30,32,112,1,"_dependencyMap"],[30,46,112,1],[31,2,1,0],[31,6,1,0,"_expoNotifications"],[31,24,1,0],[31,27,1,0,"require"],[31,34,1,0],[31,35,1,0,"_dependencyMap"],[31,49,1,0],[32,2,1,0],[32,6,1,0,"Notifications"],[32,19,1,0],[32,22,1,0,"_interopNamespace"],[32,39,1,0],[32,40,1,0,"_expoNotifications"],[32,58,1,0],[33,2,2,0],[33,6,2,0,"_expoDevice"],[33,17,2,0],[33,20,2,0,"require"],[33,27,2,0],[33,28,2,0,"_dependencyMap"],[33,42,2,0],[34,2,2,0],[34,6,2,0,"Device"],[34,12,2,0],[34,15,2,0,"_interopNamespace"],[34,32,2,0],[34,33,2,0,"_expoDevice"],[34,44,2,0],[35,2,2,38],[35,6,2,38,"_reactNativeWebDistExportsPlatform"],[35,40,2,38],[35,43,2,38,"require"],[35,50,2,38],[35,51,2,38,"_dependencyMap"],[35,65,2,38],[36,2,2,38],[36,6,2,38,"Platform"],[36,14,2,38],[36,17,2,38,"_interopDefault"],[36,32,2,38],[36,33,2,38,"_reactNativeWebDistExportsPlatform"],[36,67,2,38],[37,2,4,0],[37,6,4,0,"_reactNativeAsyncStorageAsyncStorage"],[37,42,4,0],[37,45,4,0,"require"],[37,52,4,0],[37,53,4,0,"_dependencyMap"],[37,67,4,0],[38,2,4,0],[38,6,4,0,"AsyncStorage"],[38,18,4,0],[38,21,4,0,"_interopDefault"],[38,36,4,0],[38,37,4,0,"_reactNativeAsyncStorageAsyncStorage"],[38,73,4,0],[39,2,5,0],[39,6,5,0,"_axios"],[39,12,5,0],[39,15,5,0,"require"],[39,22,5,0],[39,23,5,0,"_dependencyMap"],[39,37,5,0],[40,2,5,0],[40,6,5,0,"axios"],[40,11,5,0],[40,14,5,0,"_interopDefault"],[40,29,5,0],[40,30,5,0,"_axios"],[40,36,5,0],[41,2,7,0],[41,8,7,6,"BACKEND_URL"],[41,19,7,17],[41,22,7,17,"_expoVirtualEnv"],[41,37,7,17],[41,38,7,17,"env"],[41,41,7,17],[41,42,7,17,"EXPO_PUBLIC_BACKEND_URL"],[41,65,7,55],[43,2,9,0],[44,0,10,0],[45,0,11,0],[46,2,12,7],[46,17,12,22,"registerForPushNotifications"],[46,45,12,50,"registerForPushNotifications"],[46,46,12,50],[46,48,12,77],[47,4,13,2],[47,8,13,6],[48,6,14,4],[49,6,15,4],[49,10,15,8],[49,11,15,9,"Device"],[49,17,15,15],[49,18,15,16,"isDevice"],[49,26,15,24],[49,28,15,26],[50,8,16,6,"console"],[50,15,16,13],[50,16,16,14,"log"],[50,19,16,17],[50,20,16,18],[50,66,16,64],[50,67,16,65],[51,8,17,6],[51,15,17,13],[51,19,17,17],[52,6,18,4],[54,6,20,4],[55,6,21,4],[55,12,21,10],[56,8,21,12,"status"],[56,14,21,18],[56,16,21,20,"existingStatus"],[57,6,21,35],[57,7,21,36],[57,10,21,39],[57,16,21,45,"Notifications"],[57,29,21,58],[57,30,21,59,"getPermissionsAsync"],[57,49,21,78],[57,50,21,79],[57,51,21,80],[58,6,22,4],[58,10,22,8,"finalStatus"],[58,21,22,19],[58,24,22,22,"existingStatus"],[58,38,22,36],[60,6,24,4],[61,6,25,4],[61,10,25,8,"existingStatus"],[61,24,25,22],[61,29,25,27],[61,38,25,36],[61,40,25,38],[62,8,26,6],[62,14,26,12],[63,10,26,14,"status"],[64,8,26,21],[64,9,26,22],[64,12,26,25],[64,18,26,31,"Notifications"],[64,31,26,44],[64,32,26,45,"requestPermissionsAsync"],[64,55,26,68],[64,56,26,69],[64,57,26,70],[65,8,27,6,"finalStatus"],[65,19,27,17],[65,22,27,20,"status"],[65,28,27,26],[66,6,28,4],[67,6,30,4],[67,10,30,8,"finalStatus"],[67,21,30,19],[67,26,30,24],[67,35,30,33],[67,37,30,35],[68,8,31,6,"console"],[68,15,31,13],[68,16,31,14,"log"],[68,19,31,17],[68,20,31,18],[68,64,31,62],[68,65,31,63],[69,8,32,6],[69,15,32,13],[69,19,32,17],[70,6,33,4],[72,6,35,4],[73,6,36,4],[73,12,36,10,"tokenData"],[73,21,36,19],[73,24,36,22],[73,30,36,28,"Notifications"],[73,43,36,41],[73,44,36,42,"getExpoPushTokenAsync"],[73,65,36,63],[73,66,36,64],[74,8,37,6,"projectId"],[74,17,37,15],[74,19,37,17],[75,6,38,4],[75,7,38,5],[75,8,38,6],[76,6,40,4],[76,12,40,10,"token"],[76,17,40,15],[76,20,40,18,"tokenData"],[76,29,40,27],[76,30,40,28,"data"],[76,34,40,32],[77,6,41,4,"console"],[77,13,41,11],[77,14,41,12,"log"],[77,17,41,15],[77,18,41,16],[77,36,41,34],[77,38,41,36,"token"],[77,43,41,41],[77,44,41,42],[79,6,43,4],[80,6,44,4],[80,10,44,8,"Platform"],[80,18,44,16],[80,19,44,16,"default"],[80,26,44,16],[80,27,44,17,"OS"],[80,29,44,19],[80,34,44,24],[80,43,44,33],[80,45,44,35],[81,8,45,6],[81,14,45,12,"Notifications"],[81,27,45,25],[81,28,45,26,"setNotificationChannelAsync"],[81,55,45,53],[81,56,45,54],[81,65,45,63],[81,67,45,65],[82,10,46,8,"name"],[82,14,46,12],[82,16,46,14],[82,34,46,32],[83,10,47,8,"importance"],[83,20,47,18],[83,22,47,20,"Notifications"],[83,35,47,33],[83,36,47,34,"AndroidImportance"],[83,53,47,51],[83,54,47,52,"MAX"],[83,57,47,55],[84,10,48,8,"vibrationPattern"],[84,26,48,24],[84,28,48,26],[84,29,48,27],[84,30,48,28],[84,32,48,30],[84,35,48,33],[84,37,48,35],[84,40,48,38],[84,42,48,40],[84,45,48,43],[84,46,48,44],[85,10,49,8,"lightColor"],[85,20,49,18],[85,22,49,20],[85,31,49,29],[86,10,50,8,"sound"],[86,15,50,13],[86,17,50,15],[87,8,51,6],[87,9,51,7],[87,10,51,8],[88,8,53,6],[88,14,53,12,"Notifications"],[88,27,53,25],[88,28,53,26,"setNotificationChannelAsync"],[88,55,53,53],[88,56,53,54],[88,67,53,65],[88,69,53,67],[89,10,54,8,"name"],[89,14,54,12],[89,16,54,14],[89,34,54,32],[90,10,55,8,"importance"],[90,20,55,18],[90,22,55,20,"Notifications"],[90,35,55,33],[90,36,55,34,"AndroidImportance"],[90,53,55,51],[90,54,55,52,"MAX"],[90,57,55,55],[91,10,56,8,"vibrationPattern"],[91,26,56,24],[91,28,56,26],[91,29,56,27],[91,30,56,28],[91,32,56,30],[91,35,56,33],[91,37,56,35],[91,40,56,38],[91,42,56,40],[91,45,56,43],[91,46,56,44],[92,10,57,8,"lightColor"],[92,20,57,18],[92,22,57,20],[92,31,57,29],[93,10,58,8,"sound"],[93,15,58,13],[93,17,58,15],[93,26,58,24],[94,10,59,8,"bypassDnd"],[94,19,59,17],[94,21,59,19],[95,8,60,6],[95,9,60,7],[95,10,60,8],[96,6,61,4],[97,6,63,4],[97,13,63,11,"token"],[97,18,63,16],[98,4,64,2],[98,5,64,3],[98,6,64,4],[98,13,64,11,"error"],[98,18,64,16],[98,20,64,18],[99,6,65,4,"console"],[99,13,65,11],[99,14,65,12,"error"],[99,19,65,17],[99,20,65,18],[99,63,65,61],[99,65,65,63,"error"],[99,70,65,68],[99,71,65,69],[100,6,66,4],[100,13,66,11],[100,17,66,15],[101,4,67,2],[102,2,68,0],[104,2,70,0],[105,0,71,0],[106,0,72,0],[107,2,73,7],[107,17,73,22,"registerTokenWithServer"],[107,40,73,45,"registerTokenWithServer"],[107,41,73,46,"token"],[107,46,73,59],[107,48,73,79],[108,4,74,2],[108,8,74,6],[109,6,75,4],[109,12,75,10,"authToken"],[109,21,75,19],[109,24,75,22],[109,30,75,28,"AsyncStorage"],[109,42,75,40],[109,43,75,40,"default"],[109,50,75,40],[109,51,75,41,"getItem"],[109,58,75,48],[109,59,75,49],[109,71,75,61],[109,72,75,62],[110,6,76,4],[110,10,76,8],[110,11,76,9,"authToken"],[110,20,76,18],[110,22,76,20],[111,8,77,6,"console"],[111,15,77,13],[111,16,77,14,"log"],[111,19,77,17],[111,20,77,18],[111,68,77,66],[111,69,77,67],[112,8,78,6],[112,15,78,13],[112,20,78,18],[113,6,79,4],[114,6,81,4],[114,12,81,10,"axios"],[114,17,81,15],[114,18,81,15,"default"],[114,25,81,15],[114,26,81,16,"post"],[114,30,81,20],[114,31,82,6],[114,34,82,9,"BACKEND_URL"],[114,45,82,20],[114,71,82,46],[114,73,83,6,"token"],[114,78,83,11],[114,80,84,6],[115,8,85,8,"headers"],[115,15,85,15],[115,17,85,17],[116,10,86,10,"Authorization"],[116,23,86,23],[116,25,86,25],[116,35,86,35,"authToken"],[116,44,86,44],[116,46,86,46],[117,10,87,10],[117,24,87,24],[117,26,87,26],[118,8,88,8],[119,6,89,6],[119,7,90,4],[119,8,90,5],[120,6,92,4],[120,12,92,10,"AsyncStorage"],[120,24,92,22],[120,25,92,22,"default"],[120,32,92,22],[120,33,92,23,"setItem"],[120,40,92,30],[120,41,92,31],[120,53,92,43],[120,55,92,45,"token"],[120,60,92,50],[120,61,92,51],[121,6,93,4,"console"],[121,13,93,11],[121,14,93,12,"log"],[121,17,93,15],[121,18,93,16],[121,66,93,64],[121,67,93,65],[122,6,94,4],[122,13,94,11],[122,17,94,15],[123,4,95,2],[123,5,95,3],[123,6,95,4],[123,13,95,11,"error"],[123,18,95,21],[123,20,95,23],[124,6,96,4,"console"],[124,13,96,11],[124,14,96,12,"error"],[124,19,96,17],[124,20,96,18],[124,64,96,62],[124,66,96,64,"error"],[124,71,96,69],[124,72,96,70,"response"],[124,80,96,78],[124,82,96,80,"data"],[124,86,96,84],[124,90,96,88,"error"],[124,95,96,93],[124,96,96,94,"message"],[124,103,96,101],[124,104,96,102],[125,6,97,4],[125,13,97,11],[125,18,97,16],[126,4,98,2],[127,2,99,0],[129,2,101,0],[130,0,102,0],[131,0,103,0],[132,2,104,7],[132,17,104,22,"setupPushNotifications"],[132,39,104,44,"setupPushNotifications"],[132,40,104,44],[132,42,104,65],[133,4,105,2],[133,10,105,8,"token"],[133,15,105,13],[133,18,105,16],[133,24,105,22,"registerForPushNotifications"],[133,52,105,50],[133,53,105,51],[133,54,105,52],[134,4,107,2],[134,8,107,6,"token"],[134,13,107,11],[134,15,107,13],[135,6,108,4],[135,13,108,11],[135,19,108,17,"registerTokenWithServer"],[135,42,108,40],[135,43,108,41,"token"],[135,48,108,46],[135,49,108,47],[136,4,109,2],[137,4,111,2],[137,11,111,9],[137,16,111,14],[138,2,112,0],[139,0,112,1],[139,3]],"functionMap":{"names":["<global>","registerForPushNotifications","registerTokenWithServer","setupPushNotifications"],"mappings":"AAA;OCW;CDwD;OEK;CF0B;OGK;CHQ"},"hasCjsExports":false},"type":"js/module"}]}